<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Email Router - Sort Your Emails!</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap");

			body {
				font-family: "Outfit", sans-serif;
			}

			.bounce {
				animation: bounce 0.5s ease;
			}

			@keyframes bounce {
				0%,
				100% {
					transform: translateY(0);
				}
				50% {
					transform: translateY(-10px);
				}
			}

			.fade-in {
				animation: fadeIn 0.4s ease;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
		</style>
	</head>
	<body class="min-h-screen bg-gray-100 text-gray-900">
		<div class="container mx-auto px-4 py-10 max-w-2xl">
			<!-- Header -->
			<div class="text-center mb-10">
				<h1 class="text-4xl font-semibold text-gray-900 mb-2">Email Router</h1>
				<p class="text-base text-gray-600">Sort incoming messages into the right inbox.</p>
			</div>

			<!-- Main Card -->
			<div class="bg-white rounded-2xl shadow-lg p-8 mb-8 border border-gray-200">
				<!-- Input Form -->
				<div class="space-y-4 mb-6">
					<div>
						<label class="block text-sm font-medium text-gray-700 mb-2">Subject Line</label>
						<input
							type="text"
							id="subjectInput"
							placeholder="What's this email about?"
							class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 transition"
						/>
					</div>

					<div>
						<label class="block text-sm font-medium text-gray-700 mb-2">Email Body</label>
						<textarea
							id="bodyInput"
							rows="4"
							placeholder="Type or paste the email content here..."
							class="w-full px-4 py-3 rounded-xl border border-gray-300 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-100 transition resize-none"
						></textarea>
					</div>
				</div>

				<!-- Classify Button -->
				<button
					id="classifyBtn"
					onclick="classifyEmail()"
					class="w-full bg-blue-600 text-white font-semibold py-3 rounded-xl hover:bg-blue-700 transition disabled:opacity-60 disabled:cursor-not-allowed"
				>
					<span id="btnText">Classify Email</span>
				</button>

				<!-- Added loading state -->
				<div id="loading" class="hidden text-center mt-4">
					<div
						class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"
					></div>
					<p class="text-blue-600 font-medium mt-2">Processing...</p>
				</div>

				<!-- Added error display -->
				<div
					id="error"
					class="hidden mt-4 bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl"
				></div>
			</div>

			<!-- Results Card -->
			<div id="result" class="hidden bg-white rounded-2xl shadow-lg p-8 fade-in border border-gray-200">
				<!-- Main Result -->
				<div class="text-center mb-6 pb-6 border-b-2 border-gray-100">
					<div
						class="inline-block bg-blue-600 text-white px-6 py-2 rounded-full font-medium text-base mb-2 bounce"
					>
						<span id="routedBadge"></span>
					</div>
					<p id="score" class="text-gray-600 text-sm mt-2"></p>
				</div>

				<!-- Similarity Scores -->
				<div class="space-y-3">
					<h3 class="font-medium text-gray-800 mb-3">Similarity scores</h3>
					<div id="similaritiesList" class="space-y-2"></div>
				</div>
			</div>
		</div>

		<script>
			async function classifyEmail() {
				const subject = document.getElementById("subjectInput").value.trim();
				const body = document.getElementById("bodyInput").value.trim();
				const btn = document.getElementById("classifyBtn");
				const loading = document.getElementById("loading");
				const result = document.getElementById("result");
				const error = document.getElementById("error");

				if (!subject && !body) {
					error.textContent = "Please enter at least a subject or body!";
					error.classList.remove("hidden");
					return;
				}

				// Format as "Subject: ...\nBody: ..." to match training data format
				const text = `Subject: ${subject || "(no subject)"}\nBody: ${body || "(no body)"}`;

				btn.disabled = true;
				loading.classList.remove("hidden");
				result.classList.add("hidden");
				error.classList.add("hidden");

				try {
					const response = await fetch("/api/classify", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ text }),
					});

					const data = await response.json();

					if (!response.ok) {
						throw new Error(data.error || "Classification failed");
					}

					// Update UI with playful styling
					const routedBadge = document.getElementById("routedBadge");
					routedBadge.textContent = data.routed.toUpperCase();

					document.getElementById("score").textContent = `Confidence: ${(data.bestScore * 100).toFixed(
						1
					)}% (${data.bestLabel})`;

					// Create similarity bars with gradients
					const similaritiesList = document.getElementById("similaritiesList");
					similaritiesList.innerHTML = "";

					const colors = {
						billing: "bg-blue-500",
						support: "bg-blue-500",
						sales: "bg-blue-500",
						general: "bg-gray-500",
					};

					Object.entries(data.similarities)
						.sort((a, b) => b[1] - a[1])
						.forEach(([label, score]) => {
							const percentage = (score * 100).toFixed(1);
							const item = document.createElement("div");
							item.className = "flex items-center gap-3";
							item.innerHTML = `
                            <div class="w-24 text-sm font-medium text-gray-600 capitalize">${label}</div>
                            <div class="flex-1 bg-gray-200 rounded-full h-2 overflow-hidden">
                                <div class="${
									colors[label] || "bg-blue-500"
								} h-full rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                            </div>
                            <div class="w-12 text-sm font-medium text-gray-600 text-right">${percentage}%</div>
                        `;
							similaritiesList.appendChild(item);
						});

					result.classList.remove("hidden");
					result.scrollIntoView({ behavior: "smooth", block: "nearest" });
				} catch (err) {
					error.textContent = err.message || "Oops! Something went wrong. Try again?";
					error.classList.remove("hidden");
				} finally {
					btn.disabled = false;
					loading.classList.add("hidden");
				}
			}

			// Allow Ctrl+Enter to submit from textarea
			document.getElementById("bodyInput").addEventListener("keydown", (e) => {
				if (e.ctrlKey && e.key === "Enter") {
					classifyEmail();
				}
			});
		</script>
	</body>
</html>
