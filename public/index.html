<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Email Router - Sort Your Emails!</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<style>
			@import url("https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&display=swap");

			body {
				font-family: "Outfit", sans-serif;
			}

			.bounce {
				animation: bounce 0.5s ease;
			}

			@keyframes bounce {
				0%,
				100% {
					transform: translateY(0);
				}
				50% {
					transform: translateY(-10px);
				}
			}

			.fade-in {
				animation: fadeIn 0.4s ease;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}
		</style>
	</head>
	<body class="min-h-screen bg-gradient-to-br from-pink-100 via-purple-100 to-blue-100">
		<div class="container mx-auto px-4 py-8 max-w-2xl">
			<!-- Header -->
			<div class="text-center mb-8">
				<h1
					class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 mb-2"
				>
					Email Router
				</h1>
				<p class="text-lg text-gray-700">Let's sort your emails with AI magic!</p>
			</div>

			<!-- Main Card -->
			<div class="bg-white rounded-3xl shadow-2xl p-8 mb-6">
				<!-- Input Form -->
				<div class="space-y-4 mb-6">
					<div>
						<label class="block text-sm font-semibold text-gray-700 mb-2">Subject Line</label>
						<input
							type="text"
							id="subjectInput"
							placeholder="What's this email about?"
							class="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-pink-400 focus:outline-none transition-colors"
						/>
					</div>

					<div>
						<label class="block text-sm font-semibold text-gray-700 mb-2">Email Body</label>
						<textarea
							id="bodyInput"
							rows="4"
							placeholder="Type or paste the email content here..."
							class="w-full px-4 py-3 rounded-2xl border-2 border-gray-200 focus:border-purple-400 focus:outline-none transition-colors resize-none"
						></textarea>
					</div>
				</div>

				<!-- Classify Button -->
				<button
					id="classifyBtn"
					onclick="classifyEmail()"
					class="w-full bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white font-bold py-4 rounded-2xl hover:shadow-lg transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none"
				>
					<span id="btnText">Classify Email</span>
				</button>

				<!-- Added loading state -->
				<div id="loading" class="hidden text-center mt-4">
					<div
						class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-purple-500 border-t-transparent"
					></div>
					<p class="text-purple-600 font-semibold mt-2">Thinking...</p>
				</div>

				<!-- Added error display -->
				<div
					id="error"
					class="hidden mt-4 bg-red-100 border-2 border-red-300 text-red-700 px-4 py-3 rounded-2xl"
				></div>
			</div>

			<!-- Results Card -->
			<div id="result" class="hidden bg-white rounded-3xl shadow-2xl p-8 fade-in">
				<!-- Main Result -->
				<div class="text-center mb-6 pb-6 border-b-2 border-gray-100">
					<div
						class="inline-block bg-gradient-to-r from-pink-500 via-purple-500 to-blue-500 text-white px-6 py-3 rounded-full font-bold text-lg mb-2 bounce"
					>
						<span id="routedBadge"></span>
					</div>
					<p id="score" class="text-gray-600 text-sm mt-2"></p>
				</div>

				<!-- Similarity Scores -->
				<div class="space-y-3">
					<h3 class="font-bold text-gray-700 mb-3">How it scored:</h3>
					<div id="similaritiesList" class="space-y-2"></div>
				</div>
			</div>
		</div>

		<script>
			async function classifyEmail() {
				const subject = document.getElementById("subjectInput").value.trim();
				const body = document.getElementById("bodyInput").value.trim();
				const btn = document.getElementById("classifyBtn");
				const loading = document.getElementById("loading");
				const result = document.getElementById("result");
				const error = document.getElementById("error");

				if (!subject && !body) {
					error.textContent = "Please enter at least a subject or body!";
					error.classList.remove("hidden");
					return;
				}

				// Format as "Subject: ...\nBody: ..." to match training data format
				const text = `Subject: ${subject || "(no subject)"}\nBody: ${body || "(no body)"}`;

				btn.disabled = true;
				loading.classList.remove("hidden");
				result.classList.add("hidden");
				error.classList.add("hidden");

				try {
					const response = await fetch("/api/classify", {
						method: "POST",
						headers: { "Content-Type": "application/json" },
						body: JSON.stringify({ text }),
					});

					const data = await response.json();

					if (!response.ok) {
						throw new Error(data.error || "Classification failed");
					}

					// Update UI with playful styling
					const routedBadge = document.getElementById("routedBadge");
					routedBadge.textContent = data.routed.toUpperCase();

					document.getElementById("score").textContent = `Confidence: ${(data.bestScore * 100).toFixed(
						1
					)}% (${data.bestLabel})`;

					// Create similarity bars with gradients
					const similaritiesList = document.getElementById("similaritiesList");
					similaritiesList.innerHTML = "";

					const colors = {
						billing: "from-pink-400 to-pink-600",
						support: "from-purple-400 to-purple-600",
						sales: "from-blue-400 to-blue-600",
						general: "from-gray-400 to-gray-600",
					};

					Object.entries(data.similarities)
						.sort((a, b) => b[1] - a[1])
						.forEach(([label, score]) => {
							const percentage = (score * 100).toFixed(1);
							const item = document.createElement("div");
							item.className = "flex items-center gap-3";
							item.innerHTML = `
                            <div class="w-24 text-sm font-semibold text-gray-700 capitalize">${label}</div>
                            <div class="flex-1 bg-gray-100 rounded-full h-3 overflow-hidden">
                                <div class="bg-gradient-to-r ${
									colors[label] || "from-gray-400 to-gray-600"
								} h-full rounded-full transition-all duration-500" style="width: ${percentage}%"></div>
                            </div>
                            <div class="w-12 text-sm font-semibold text-gray-700 text-right">${percentage}%</div>
                        `;
							similaritiesList.appendChild(item);
						});

					result.classList.remove("hidden");
					result.scrollIntoView({ behavior: "smooth", block: "nearest" });
				} catch (err) {
					error.textContent = err.message || "Oops! Something went wrong. Try again?";
					error.classList.remove("hidden");
				} finally {
					btn.disabled = false;
					loading.classList.add("hidden");
				}
			}

			// Allow Ctrl+Enter to submit from textarea
			document.getElementById("bodyInput").addEventListener("keydown", (e) => {
				if (e.ctrlKey && e.key === "Enter") {
					classifyEmail();
				}
			});
		</script>
	</body>
</html>
